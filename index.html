<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>SoundStudy for All - Demo Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050816;
      --bg-soft: #0f172a;
      --card: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.2);
      --accent-strong: #0ea5e9;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --border: #1f2937;
      --radius-lg: 18px;
      --radius-xl: 24px;
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.45);
      --transition-fast: 0.2s ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 52%, #020617 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      -webkit-tap-highlight-color: transparent; /* ëª¨ë°”ì¼ íƒ­ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
    }

    .app-shell {
      max-width: 1080px;
      margin: 0 auto;
      padding: 20px 16px 40px;
      width: 100%;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-logo {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      background: conic-gradient(from 160deg, #38bdf8, #818cf8, #22c55e, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 32px rgba(56,189,248,0.55);
      flex-shrink: 0;
    }

    .brand-logo span {
      font-weight: 800;
      font-size: 20px;
      color: #0b1120;
    }

    .brand-text-title {
      font-size: 20px;
      font-weight: 700;
    }

    .brand-text-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .tagline-pill {
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(148,163,184,0.5);
      background: linear-gradient(to right, rgba(15,23,42,0.9), rgba(15,23,42,0.4));
      display: inline-flex;
      align-items: center;
      gap: 6px;
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tagline-pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle, #4ade80, #22c55e);
      box-shadow: 0 0 14px rgba(34,197,94,0.8);
      flex-shrink: 0;
    }

    .top-grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.6fr);
      gap: 16px;
      margin-bottom: 16px;
    }

    @media (max-width: 880px) {
      .top-grid {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.2), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(15,118,110,0.28), transparent 55%),
                  var(--card);
      border-radius: var(--radius-xl);
      padding: 18px 18px 16px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at top center, rgba(248,250,252,0.06), transparent 65%);
      opacity: 0.9;
      mix-blend-mode: screen;
    }

    .card > * {
      position: relative;
      z-index: 1;
    }

    .hero-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .hero-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 16px;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 14px;
    }

    .hero-badge {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.84);
      border: 1px solid rgba(148,163,184,0.6);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hero-badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .hero-kpi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .hero-kpi {
      padding: 7px 9px;
      border-radius: 999px;
      background: rgba(15,23,42,0.88);
      border: 1px solid rgba(55,65,81,0.8);
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
    }

    .hero-kpi strong {
      font-size: 13px;
      color: var(--accent-strong);
    }

    .stats-card {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .level-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .level-label {
      font-size: 13px;
      font-weight: 500;
    }

    .level-pill {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(148,163,184,0.7);
    }

    .xp-bar-wrap {
      height: 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(31,41,55,0.85);
      overflow: hidden;
      position: relative;
    }

    .xp-bar-fill {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #22c55e, #4ade80, #38bdf8);
      transition: width var(--transition-fast);
    }

    .xp-bar-wrap::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image: linear-gradient(
        120deg,
        rgba(15,23,42,0.0) 0,
        rgba(15,23,42,0.85) 40%,
        rgba(15,23,42,0.85) 60%,
        rgba(15,23,42,0.0) 100%
      );
      background-size: 220% 100%;
      animation: xpShimmer 3.6s infinite linear;
      mix-blend-mode: soft-light;
    }

    @keyframes xpShimmer {
      0% { background-position: -100% 0; }
      100% { background-position: 200% 0; }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 8px;
      font-size: 11px;
    }

    .stat-mini {
      padding: 8px 9px;
      border-radius: 12px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(31,41,55,0.95);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .stat-mini-label {
      color: var(--text-soft);
      font-size: 11px;
    }

    .stat-mini-value {
      font-size: 13px;
      font-weight: 600;
    }

    /* NAV */
    .nav {
      display: flex;
      flex-wrap: nowrap;
      gap: 8px;
      margin-bottom: 16px;
      position: sticky;
      top: 0;
      padding: 6px 0;
      backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(15,23,42,0.96), rgba(15,23,42,0.6), transparent);
      z-index: 50;
      overflow-x: auto;             /* ëª¨ë°”ì¼ì—ì„œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
      -webkit-overflow-scrolling: touch;
    }

    .nav::-webkit-scrollbar {
      display: none;
    }

    .nav-btn {
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      padding: 8px 14px;
      font-size: 12px;
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all var(--transition-fast);
      flex-shrink: 0; /* íƒ­ì´ ì¤„ì–´ë“¤ì§€ ì•Šê³  ìŠ¤í¬ë¡¤ë˜ë„ë¡ */
    }

    .nav-btn span.icon {
      font-size: 15px;
    }

    .nav-btn.active {
      border-color: var(--accent);
      color: #e5f3ff;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.35), rgba(15,23,42,0.95));
      box-shadow: 0 0 24px rgba(56,189,248,0.45);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0,1.9fr) minmax(0,1.4fr);
      gap: 16px;
    }

    @media (max-width: 980px) {
      main {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .panel {
      background: radial-gradient(circle at top right, rgba(37,99,235,0.16), transparent 55%),
                  var(--bg-soft);
      border-radius: var(--radius-xl);
      padding: 16px 14px 14px;
      border: 1px solid var(--border);
      box-shadow: 0 20px 50px rgba(15,23,42,0.75);
      min-height: 260px;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 10px;
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title-pill {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
      white-space: nowrap;
    }

    .panel-desc {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .panel-body {
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    label {
      font-size: 12px;
      color: var(--text-soft);
      display: block;
      margin-bottom: 3px;
    }

    select, input[type="text"] {
      width: 100%;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text);
      font-size: 12px;
      outline: none;
    }

    select:focus, input[type="text"]:focus {
      border-color: var(--accent);
    }

    .btn {
      border-radius: 999px;
      padding: 8px 13px;
      font-size: 12px;
      border: 1px solid rgba(55,65,81,0.95);
      background: rgba(15,23,42,0.96);
      color: var(--text);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all var(--transition-fast);
      white-space: nowrap;
      touch-action: manipulation;
    }

    .btn-primary {
      background: linear-gradient(135deg, #38bdf8, #4f46e5);
      border-color: transparent;
      color: #0b1120;
      font-weight: 600;
      box-shadow: 0 15px 30px rgba(56,189,248,0.7);
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: rgba(15,23,42,0.9);
    }

    .btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .hint {
      font-size: 11px;
      color: var(--text-soft);
    }

    .hint-strong {
      color: var(--accent-strong);
    }

    /* Pronunciation canvas & feedback */
    .wave-container {
      position: relative;
      border-radius: 16px;
      border: 1px solid rgba(55,65,81,0.9);
      overflow: hidden;
      background: radial-gradient(circle at center, rgba(15,23,42,0.8), #020617);
      margin-top: 4px;
    }

    canvas#waveform {
      width: 100%;
      height: 140px; /* ëª¨ë°”ì¼ì—ì„œë„ ë³´ê¸° ì¢‹ì€ ë†’ì´ */
      min-height: 120px;
      display: block;
      background: transparent;
    }

    .wave-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-image: linear-gradient(
        to right,
        rgba(15,23,42,0.0) 0,
        rgba(15,23,42,0.7) 50%,
        rgba(15,23,42,0.0) 100%
      );
      mix-blend-mode: soft-light;
      opacity: 0.4;
    }

    .pronunciation-feedback {
      display: grid;
      grid-template-columns: 1.6fr 1.2fr;
      gap: 8px;
      margin-top: 6px;
    }

    @media (max-width: 520px) {
      .pronunciation-feedback {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .feedback-box {
      padding: 8px 9px;
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.96);
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .feedback-title {
      font-size: 11px;
      color: var(--text-soft);
    }

    .feedback-score {
      font-size: 20px;
      font-weight: 700;
    }

    .feedback-score.good {
      color: var(--success);
    }

    .feedback-score.bad {
      color: var(--danger);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(55,65,81,0.9);
    }

    /* Vibration */
    .pattern-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px,1fr));
      gap: 8px;
    }

    .pattern-card {
      padding: 8px 9px;
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.96);
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
    }

    .pattern-title {
      font-weight: 500;
    }

    /* Lipreading */
    .lip-card {
      padding: 8px 9px;
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.96);
      display: grid;
      grid-template-columns: minmax(0,1.3fr) minmax(0,1.5fr);
      gap: 10px;
    }

    @media (max-width: 640px) {
      .lip-card {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .lip-mouth {
      border-radius: 12px;
      border: 1px solid rgba(75,85,99,0.9);
      padding: 8px;
      background: radial-gradient(circle at top, rgba(56,189,248,0.22), rgba(15,23,42,0.98));
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .mouth-shape {
      width: 100%;
      height: 80px;
      border-radius: 999px;
      border: 2px solid rgba(148,163,184,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      letter-spacing: 0.04em;
      background: radial-gradient(circle at top, rgba(248,250,252,0.04), rgba(15,23,42,0.98));
    }

    .mouth-label {
      font-size: 11px;
      color: var(--text-soft);
    }

    .lip-camera {
      border-radius: 12px;
      border: 1px dashed rgba(75,85,99,0.9);
      padding: 6px;
      background: rgba(15,23,42,0.9);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    video#cameraPreview {
      width: 100%;
      border-radius: 10px;
      background: #020617;
    }

    /* Gamification side */
    .badge-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px,1fr));
      gap: 8px;
      font-size: 12px;
    }

    .badge-card {
      padding: 8px 9px;
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.96);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .badge-name {
      font-weight: 500;
    }

    .badge-progress {
      font-size: 11px;
      color: var(--text-soft);
    }

    .log {
      margin-top: 6px;
      max-height: 120px;
      overflow-y: auto;
      font-size: 11px;
      color: var(--text-soft);
    }

    .log-entry {
      padding: 3px 0;
      border-bottom: 1px dashed rgba(31,41,55,0.8);
    }

    .pill-small {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      font-size: 10px;
      margin-left: 6px;
      color: var(--text-soft);
    }

    .text-success {
      color: var(--success);
    }

    .text-danger {
      color: var(--danger);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }

    /* ì‘ì€ í™”ë©´ì—ì„œ ì „ì²´ íŒ¨ë”©/ë²„íŠ¼ í¬ê¸° ì‚´ì§ í‚¤ìš°ê¸° */
    @media (max-width: 640px) {
      .app-shell {
        padding: 14px 10px 28px;
      }
      .btn {
        padding: 9px 14px;
        font-size: 13px;
      }
      .hero-title {
        font-size: 18px;
      }
      .brand-text-title {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="brand">
      <div class="brand-logo"><span>SS</span></div>
      <div>
        <div class="brand-text-title">SoundStudy for All Â· Demo</div>
        <div class="brand-text-sub">ë“¤ì„ ìˆ˜ ì—†ì–´ë„, ë°œìŒê³¼ ë¦¬ë“¬ì„ <strong>ë³´ê³ Â·ëŠë¼ë©°</strong> ë°°ìš°ëŠ” ì›¹ í”„ë¡œí† íƒ€ì…</div>
      </div>
    </div>
    <div>
      <div class="tagline-pill">
        <span class="tagline-pill-dot"></span>
        <span>AI í”¼ë“œë°± Â· ì§„ë™ Â· ë¦½ë¦¬ë”© Â· ê²Œì„í™” â€” ë¸Œë¼ìš°ì € ë°ëª¨</span>
      </div>
    </div>
  </header>

  <section class="top-grid">
    <article class="card">
      <div class="hero-title">ì²­ê° ì •ë³´ë¥¼ ì‹œê°Â·ì´‰ê°ìœ¼ë¡œ ë°”ê¾¸ëŠ” ì–¸ì–´ í•™ìŠµ í”Œë«í¼</div>
      <div class="hero-subtitle">
        ì´ ì›¹ ë°ëª¨ëŠ” ì‹¤ì œ ì•±ì˜ ê¸°ëŠ¥ì„ í”„ë¡ íŠ¸ì—”ë“œë§Œìœ¼ë¡œ êµ¬í˜„í•œ í”„ë¡œí† íƒ€ì…ì…ë‹ˆë‹¤.
        ë§ˆì´í¬, ì§„ë™, ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì„ í—ˆìš©í•˜ë©´ ì „ì²´ ê¸°ëŠ¥ì„ ì‹œí—˜í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
      <div class="hero-badges">
        <div class="hero-badge"><span class="hero-badge-dot"></span> ì‹¤ì‹œê°„ íŒŒí˜• ì‹œê°í™”</div>
        <div class="hero-badge"><span class="hero-badge-dot"></span> ë‹¨ìˆœ AI ëª¨ì˜ ë°œìŒ ë¶„ì„</div>
        <div class="hero-badge"><span class="hero-badge-dot"></span> ì§„ë™ ë¦¬ë“¬ í”¼ë“œë°±</div>
        <div class="hero-badge"><span class="hero-badge-dot"></span> ë¦½ë¦¬ë”© &amp; ê²Œì„í™”</div>
      </div>
      <div class="hero-kpi-row">
        <div class="hero-kpi"><strong>ì‹œê°</strong><span>íŒŒí˜•Â·ìƒ‰ìƒÂ·ê·¸ë˜í”„</span></div>
        <div class="hero-kpi"><strong>ì´‰ê°</strong><span>ì§„ë™ íŒ¨í„´ìœ¼ë¡œ ë¦¬ë“¬ ê²½í—˜</span></div>
        <div class="hero-kpi"><strong>AI</strong><span>í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë°˜ ëª¨ì˜ í”¼ë“œë°±</span></div>
      </div>
    </article>
    <article class="card stats-card">
      <div class="level-row">
        <div class="level-label">ì˜¤ëŠ˜ì˜ í•™ìŠµ ì§„í–‰</div>
        <div class="level-pill"><span id="levelLabel">Lv. 1 Â· ìƒˆì‹¹ í•™ìŠµì</span></div>
      </div>
      <div class="xp-bar-wrap" aria-hidden="true">
        <div id="xpBar" class="xp-bar-fill"></div>
      </div>
      <div class="hint">ì—°ìŠµì„ ì™„ë£Œí•˜ë©´ ê²½í—˜ì¹˜ê°€ ìŒ“ì´ê³  ë ˆë²¨ì´ ìƒìŠ¹í•©ë‹ˆë‹¤.</div>
      <div class="stats-grid">
        <div class="stat-mini">
          <div class="stat-mini-label">ì´ ë°œìŒ ì—°ìŠµ</div>
          <div class="stat-mini-value" id="statAttempts">0íšŒ</div>
        </div>
        <div class="stat-mini">
          <div class="stat-mini-label">í‰ê·  ì ìˆ˜</div>
          <div class="stat-mini-value" id="statAvgScore">-</div>
        </div>
        <div class="stat-mini">
          <div class="stat-mini-label">íšë“ ë°°ì§€</div>
          <div class="stat-mini-value" id="statBadges">0ê°œ</div>
        </div>
      </div>
    </article>
  </section>

  <nav class="nav" aria-label="ë©”ì¸ ê¸°ëŠ¥ ì„ íƒ">
    <button class="nav-btn active" data-target="panel-pronunciation">
      <span class="icon">ğŸ™ï¸</span><span>AI ë°œìŒ &amp; ë¦¬ë“¬ ì—°ìŠµ</span>
    </button>
    <button class="nav-btn" data-target="panel-vibration">
      <span class="icon">ğŸ“³</span><span>ì§„ë™ í”¼ë“œë°± ì‹¤í—˜</span>
    </button>
    <button class="nav-btn" data-target="panel-lipreading">
      <span class="icon">ğŸ‘„</span><span>ë¦½ë¦¬ë”©(êµ¬í™”) í›ˆë ¨</span>
    </button>
    <button class="nav-btn" data-target="panel-gamification">
      <span class="icon">ğŸ†</span><span>ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜ & ë¡œê·¸</span>
    </button>
  </nav>

  <main>
    <!-- LEFT COLUMN -->
    <section id="panel-pronunciation" class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span>ğŸ™ï¸ AI ë°œìŒ ë¶„ì„ &amp; ë¦¬ë“¬ ì‹œê°í™”</span>
        </div>
        <div class="panel-title-pill">ë¸Œë¼ìš°ì € Web Audio + ëª¨ì˜ AI ë¶„ì„</div>
      </div>
      <div class="panel-desc">
        ëª©í‘œ ë¬¸ì¥ì„ ì„ íƒí•˜ê³  <strong>ë…¹ìŒ â†’ ë¶„ì„</strong>ì„ ëˆŒëŸ¬ ë³´ì„¸ìš”.
        ì‹¤ì œ ë”¥ëŸ¬ë‹ ëŒ€ì‹ , ê¸¸ì´Â·ë³¼ë¥¨ ê¸°ë°˜ <span class="hint-strong">ê°„ë‹¨í•œ ëª¨ì˜ ë¶„ì„</span>ìœ¼ë¡œ ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
      </div>
      <div class="panel-body">
        <div>
          <label for="targetSentence">ì˜¤ëŠ˜ì˜ ëª©í‘œ ë°œìŒ</label>
          <select id="targetSentence">
            <option value="ì•ˆë…•í•˜ì„¸ìš”">ì•ˆë…•í•˜ì„¸ìš”</option>
            <option value="ê³ ë§ˆì›Œìš”">ê³ ë§ˆì›Œìš”</option>
            <option value="ì˜¤ëŠ˜ì€ ì¦ê±°ìš´ ìˆ˜ì—…ì´ì—ìš”">ì˜¤ëŠ˜ì€ ì¦ê±°ìš´ ìˆ˜ì—…ì´ì—ìš”</option>
            <option value="ì†Œë¦¬ë¥¼ ë³´ê³  ëŠë¼ë©° ë°°ì›Œìš”">ì†Œë¦¬ë¥¼ ë³´ê³  ëŠë¼ë©° ë°°ì›Œìš”</option>
          </select>
        </div>
        <div>
          <div class="btn-row">
            <button id="btnStartRecord" class="btn btn-primary">
              <span>â—</span> <span>ë…¹ìŒ ì‹œì‘</span>
            </button>
            <button id="btnStopRecord" class="btn btn-ghost" disabled>
              â¹ ë…¹ìŒ ì¢…ë£Œ
            </button>
            <button id="btnAnalyze" class="btn btn-ghost" disabled>
              ğŸ“Š ë¶„ì„ & í”¼ë“œë°±
            </button>
          </div>
          <div class="hint">
            ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ <strong>HTTPS</strong> í™˜ê²½ì—ì„œ ê°€ì¥ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
          </div>
        </div>
        <div class="wave-container" aria-label="ì‹¤ì‹œê°„ ë°œìŒ íŒŒí˜•">
          <canvas id="waveform"></canvas>
          <div class="wave-overlay"></div>
        </div>
        <div class="pronunciation-feedback">
          <div class="feedback-box">
            <div class="feedback-title">ë°œìŒ ì •í™•ë„ (ëª¨ì˜ AI)</div>
            <div class="feedback-score" id="scoreText">-</div>
            <div id="scoreDetail" class="hint"></div>
          </div>
          <div class="feedback-box">
            <div class="feedback-title">ë¦¬ë“¬ &amp; ê°•ë„ ë¶„ì„</div>
            <div class="chip-row" id="rhythmChips">
              <!-- JSì—ì„œ ì±„ì›Œì§ -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="panel-vibration" class="panel" hidden>
      <div class="panel-header">
        <div class="panel-title">
          <span>ğŸ“³ ì§„ë™ í”¼ë“œë°± ì‹œìŠ¤í…œ</span>
        </div>
        <div class="panel-title-pill">ëª¨ë°”ì¼Â·ì§€ì› ë¸Œë¼ìš°ì €ì—ì„œ ë™ì‘</div>
      </div>
      <div class="panel-desc">
        ë¦¬ë“¬, ê°•ì„¸, ì¡°í•© íŒ¨í„´ì„ ëˆŒëŸ¬ ë³´ì„¸ìš”. <strong>navigator.vibrate</strong> APIë¥¼ ì‚¬ìš©í•´
        PPTì—ì„œ ì œì•ˆí•œ ì§„ë™ í”¼ë“œë°±ì„ ë¸Œë¼ìš°ì €ì—ì„œ ì²´í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
      <div class="panel-body">
        <div class="pattern-grid">
          <div class="pattern-card">
            <div class="pattern-title">ë¦¬ë“¬ íŒ¨í„´</div>
            <div class="hint">ë¬¸ì¥ ì „ì²´ ë¦¬ë“¬ì„ ê¸¸ê³  ì§§ì€ ì§„ë™ìœ¼ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.</div>
            <button class="btn btn-primary" data-vibrate="rhythm">â–¶ ì¬ìƒ</button>
          </div>
          <div class="pattern-card">
            <div class="pattern-title">ê°•ì„¸ íŒ¨í„´</div>
            <div class="hint">ê°•í•œ ìŒì ˆì— ë” ê°•í•œ ì§„ë™ì„ ì¤ë‹ˆë‹¤.</div>
            <button class="btn btn-primary" data-vibrate="stress">â–¶ ì¬ìƒ</button>
          </div>
          <div class="pattern-card">
            <div class="pattern-title">ì§€ì†ì‹œê°„ íŒ¨í„´</div>
            <div class="hint">ê¸¸ê²Œ ë°œìŒí•  ëª¨ìŒì— ê¸´ ì§„ë™ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.</div>
            <button class="btn btn-primary" data-vibrate="length">â–¶ ì¬ìƒ</button>
          </div>
          <div class="pattern-card">
            <div class="pattern-title">ì¡°í•© íŒ¨í„´</div>
            <div class="hint">ë¦¬ë“¬+ê°•ì„¸+ì§€ì†ì‹œê°„ì´ ì„ì¸ ë³µí•© íŒ¨í„´ì…ë‹ˆë‹¤.</div>
            <button class="btn btn-primary" data-vibrate="combo">â–¶ ì¬ìƒ</button>
          </div>
        </div>
        <div class="hint">
          ì¼ë¶€ ë°ìŠ¤í¬í†± ë¸Œë¼ìš°ì €ëŠ” ì§„ë™ì„ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          ê°€ëŠ¥í•œ ê²½ìš° ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì—´ì–´ í…ŒìŠ¤íŠ¸í•´ ë³´ì„¸ìš”.
        </div>
        <div class="hint" id="vibrationStatus"></div>
      </div>
    </section>

    <!-- RIGHT COLUMN -->
    <section id="panel-lipreading" class="panel" hidden>
      <div class="panel-header">
        <div class="panel-title">
          <span>ğŸ‘„ ë¦½ë¦¬ë”©(êµ¬í™”) í•™ìŠµ ëª¨ë“ˆ</span>
        </div>
        <div class="panel-title-pill">ì…ëª¨ì–‘ ì¹´ë“œ + ì¹´ë©”ë¼ ë¯¸ë¦¬ë³´ê¸°</div>
      </div>
      <div class="panel-desc">
        ì‹¤ì œ AI ë¦½ë¦¬ë”© ëŒ€ì‹ , <strong>ì…ëª¨ì–‘ ì˜ˆì‹œ ì¹´ë“œ</strong>ì™€
        <strong>ì¹´ë©”ë¼ ë¯¸ë¦¬ë³´ê¸°</strong>ë¡œ ê¸°ë³¸ êµ¬ì¡°ë¥¼ ë³´ì—¬ì£¼ëŠ” ë°ëª¨ì…ë‹ˆë‹¤.
      </div>
      <div class="panel-body">
        <div class="lip-card">
          <div class="lip-mouth">
            <div class="mouth-label">í˜„ì¬ ì—°ìŠµ ìŒì†Œ</div>
            <div class="mouth-shape" id="mouthShape">ì•„</div>
            <div class="mouth-label" id="mouthDescription">ì…ì„ í¬ê²Œ ë²Œë¦¬ê³  í„±ì„ ì¶©ë¶„íˆ ë‚´ë ¤ ì£¼ì„¸ìš”.</div>
            <div class="btn-row">
              <button class="btn btn-primary" id="btnPrevMouth">â—€ ì´ì „</button>
              <button class="btn btn-primary" id="btnNextMouth">ë‹¤ìŒ â–¶</button>
            </div>
          </div>
          <div class="lip-camera">
            <div class="hint">
              ì•„ë˜ ì¹´ë©”ë¼ëŠ” í•™ìŠµìì˜ ì…ëª¨ì–‘ì„ ë³´ì—¬ ì£¼ëŠ” <strong>ë¯¸ë¦¬ë³´ê¸°</strong>ì…ë‹ˆë‹¤.
              ì‹¤ì œ ë¦½ë¦¬ë”© AI ëª¨ë¸ì€ ì„œë²„/ì•±ì—ì„œ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
            <video id="cameraPreview" autoplay playsinline muted></video>
            <div class="btn-row">
              <button class="btn btn-primary" id="btnStartCamera">ğŸ“· ì¹´ë©”ë¼ ì¼œê¸°</button>
              <button class="btn btn-ghost" id="btnStopCamera" disabled>â¹ ì¹´ë©”ë¼ ë„ê¸°</button>
            </div>
            <div class="hint" id="cameraStatus"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="panel-gamification" class="panel" hidden>
      <div class="panel-header">
        <div class="panel-title">
          <span>ğŸ† ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜ &amp; í•™ìŠµ ë¡œê·¸</span>
        </div>
        <div class="panel-title-pill">ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ ì§„í–‰ë„ ì €ì¥</div>
      </div>
      <div class="panel-desc">
        ë°œìŒ ì—°ìŠµì„ í• ìˆ˜ë¡ ê²½í—˜ì¹˜ì™€ ë°°ì§€ê°€ ìŒ“ì…ë‹ˆë‹¤.
        ì´ ë°ëª¨ì—ì„œëŠ” ë¸Œë¼ìš°ì € <strong>localStorage</strong>ë¥¼ ì‚¬ìš©í•´ ì§„í–‰ë„ë¥¼ ì„ì‹œ ì €ì¥í•©ë‹ˆë‹¤.
      </div>
      <div class="panel-body">
        <div class="badge-grid">
          <div class="badge-card">
            <div class="badge-name">ê¾¸ì¤€í•œ ì—°ìŠµê°€</div>
            <div class="badge-progress">ë°œìŒ ì—°ìŠµ 5íšŒ ë‹¬ì„± ì‹œ íšë“</div>
            <div id="badge1Status" class="pill-small">ë¯¸íšë“</div>
          </div>
          <div class="badge-card">
            <div class="badge-name">ë¦¬ë“¬ ë§ˆìŠ¤í„°</div>
            <div class="badge-progress">í‰ê·  ì ìˆ˜ 80ì  ì´ìƒ ë‹¬ì„±</div>
            <div id="badge2Status" class="pill-small">ë¯¸íšë“</div>
          </div>
          <div class="badge-card">
            <div class="badge-name">ì™„ì£¼ëŸ¬</div>
            <div class="badge-progress">ë°œìŒÂ·ì§„ë™Â·ë¦½ë¦¬ë”© ëª¨ë‘ ì²´í—˜</div>
            <div id="badge3Status" class="pill-small">ë¯¸íšë“</div>
          </div>
        </div>
        <div class="btn-row" style="margin-top:10px;">
          <button class="btn btn-ghost" id="btnResetProgress">ì´ˆê¸°í™”</button>
        </div>
        <div class="log" id="eventLog" aria-label="í•™ìŠµ í™œë™ ë¡œê·¸"></div>
      </div>
    </section>
  </main>
</div>

<script>
  "use strict";

  // ----------------------
  // ìƒíƒœ ê´€ë¦¬ & ìœ í‹¸
  // ----------------------
  const state = {
    xp: 0,
    level: 1,
    attempts: 0,
    totalScore: 0,
    badges: {
      consistency: false,
      rhythmMaster: false,
      allModules: false
    },
    usedModules: {
      pronunciation: false,
      vibration: false,
      lipreading: false
    }
  };

  const STORAGE_KEY = "soundstudy_demo_progress_v1";

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const data = JSON.parse(raw);
        Object.assign(state, data);
      }
    } catch (e) {
      console.warn("Failed to load state:", e);
    }
    updateUIFromState();
  }

  function saveState() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch (e) {
      console.warn("Failed to save state:", e);
    }
  }

  function logEvent(message) {
    const log = document.getElementById("eventLog");
    if (!log) return;
    const div = document.createElement("div");
    div.className = "log-entry";
    const now = new Date();
    const time = now.toTimeString().slice(0, 5);
    div.textContent = `[${time}] ${message}`;
    log.prepend(div);
  }

  function addXP(amount) {
    state.xp += amount;
    const newLevel = Math.floor(state.xp / 100) + 1;
    if (newLevel > state.level) {
      state.level = newLevel;
      logEvent(`ë ˆë²¨ ì—…! í˜„ì¬ ë ˆë²¨: ${state.level}`);
    }
    updateUIFromState();
    saveState();
  }

  function updateBadgesAndStats() {
    if (state.attempts >= 5 && !state.badges.consistency) {
      state.badges.consistency = true;
      logEvent("ë°°ì§€ íšë“: ê¾¸ì¤€í•œ ì—°ìŠµê°€");
    }

    const avgScore = state.attempts > 0 ? Math.round(state.totalScore / state.attempts) : 0;

    if (avgScore >= 80 && !state.badges.rhythmMaster) {
      state.badges.rhythmMaster = true;
      logEvent("ë°°ì§€ íšë“: ë¦¬ë“¬ ë§ˆìŠ¤í„°");
    }

    if (
      state.usedModules.pronunciation &&
      state.usedModules.vibration &&
      state.usedModules.lipreading &&
      !state.badges.allModules
    ) {
      state.badges.allModules = true;
      logEvent("ë°°ì§€ íšë“: ì™„ì£¼ëŸ¬");
    }

    updateUIFromState();
    saveState();
  }

  function updateUIFromState() {
    const xpBar = document.getElementById("xpBar");
    const levelLabel = document.getElementById("levelLabel");
    const statAttempts = document.getElementById("statAttempts");
    const statAvgScore = document.getElementById("statAvgScore");
    const statBadges = document.getElementById("statBadges");

    const currentLevelXp = state.xp % 100;
    const percent = Math.max(5, Math.min(100, (currentLevelXp / 100) * 100));
    if (xpBar) xpBar.style.width = percent + "%";
    if (levelLabel) levelLabel.textContent = `Lv. ${state.level} Â· í•™ìŠµì`;

    if (statAttempts) statAttempts.textContent = state.attempts + "íšŒ";
    const avgScore = state.attempts > 0 ? Math.round(state.totalScore / state.attempts) : 0;
    if (statAvgScore) statAvgScore.textContent = state.attempts > 0 ? avgScore + "ì " : "-";

    const badgeCount =
      (state.badges.consistency ? 1 : 0) +
      (state.badges.rhythmMaster ? 1 : 0) +
      (state.badges.allModules ? 1 : 0);
    if (statBadges) statBadges.textContent = badgeCount + "ê°œ";

    const badge1 = document.getElementById("badge1Status");
    const badge2 = document.getElementById("badge2Status");
    const badge3 = document.getElementById("badge3Status");

    if (badge1) {
      badge1.textContent = state.badges.consistency ? "íšë“ ì™„ë£Œ" : "ë¯¸íšë“";
      badge1.classList.toggle("text-success", state.badges.consistency);
    }
    if (badge2) {
      badge2.textContent = state.badges.rhythmMaster ? "íšë“ ì™„ë£Œ" : "ë¯¸íšë“";
      badge2.classList.toggle("text-success", state.badges.rhythmMaster);
    }
    if (badge3) {
      badge3.textContent = state.badges.allModules ? "íšë“ ì™„ë£Œ" : "ë¯¸íšë“";
      badge3.classList.toggle("text-success", state.badges.allModules);
    }
  }

  // ----------------------
  // ë„¤ë¹„ê²Œì´ì…˜
  // ----------------------
  document.querySelectorAll(".nav-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const targetId = btn.getAttribute("data-target");
      document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      document.querySelectorAll("main > section").forEach(panel => {
        panel.hidden = panel.id !== targetId;
      });
    });
  });

  // ----------------------
  // Web Audio + ë…¹ìŒ + íŒŒí˜•
  // ----------------------
  let audioContext = null;
  let analyser = null;
  let mediaStream = null;
  let dataArray = null;
  let waveAnimationId = null;
  let recordingChunks = [];
  let mediaRecorder = null;
  let recordingStartTime = 0;
  let lastRMS = 0;

  const waveformCanvas = document.getElementById("waveform");
  const canvasCtx = waveformCanvas.getContext("2d");

  function resizeCanvas() {
    if (!waveformCanvas) return;
    const rect = waveformCanvas.getBoundingClientRect();
    waveformCanvas.width = rect.width * window.devicePixelRatio;
    waveformCanvas.height = rect.height * window.devicePixelRatio;
  }

  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  function drawWaveform() {
    if (!analyser || !canvasCtx) return;
    const bufferLength = analyser.fftSize;
    if (!dataArray || dataArray.length !== bufferLength) {
      dataArray = new Uint8Array(bufferLength);
    }
    analyser.getByteTimeDomainData(dataArray);

    const width = waveformCanvas.width;
    const height = waveformCanvas.height;
    canvasCtx.clearRect(0, 0, width, height);

    canvasCtx.fillStyle = "#020617";
    canvasCtx.fillRect(0, 0, width, height);

    canvasCtx.strokeStyle = "rgba(148,163,184,0.4)";
    canvasCtx.lineWidth = 1 * window.devicePixelRatio;
    canvasCtx.beginPath();
    canvasCtx.moveTo(0, height / 2);
    canvasCtx.lineTo(width, height / 2);
    canvasCtx.stroke();

    canvasCtx.lineWidth = 2.4 * window.devicePixelRatio;
    canvasCtx.strokeStyle = "#38bdf8";
    canvasCtx.beginPath();

    const sliceWidth = width / bufferLength;
    let x = 0;

    let sumSquares = 0;

    for (let i = 0; i < bufferLength; i++) {
      const v = dataArray[i] / 128.0 - 1.0;
      const y = height / 2 + v * (height / 2) * 0.9;
      if (i === 0) {
        canvasCtx.moveTo(x, y);
      } else {
        canvasCtx.lineTo(x, y);
      }
      x += sliceWidth;
      sumSquares += v * v;
    }
    canvasCtx.stroke();

    const rms = Math.sqrt(sumSquares / bufferLength);
    lastRMS = rms;

    waveAnimationId = requestAnimationFrame(drawWaveform);
  }

  async function startRecording() {
    try {
      state.usedModules.pronunciation = true;
      updateBadgesAndStats();

      const btnStart = document.getElementById("btnStartRecord");
      const btnStop = document.getElementById("btnStopRecord");
      const btnAnalyze = document.getElementById("btnAnalyze");

      btnStart.disabled = true;
      btnStop.disabled = false;
      btnAnalyze.disabled = true;

      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }

      mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(mediaStream);
      recordingChunks = [];
      recordingStartTime = performance.now();

      mediaRecorder.ondataavailable = event => {
        if (event.data && event.data.size > 0) {
          recordingChunks.push(event.data);
        }
      };

      mediaRecorder.onstop = () => {
        btnAnalyze.disabled = recordingChunks.length === 0;
        btnStart.disabled = false;
        btnStop.disabled = true;
      };

      mediaRecorder.start();

      const source = audioContext.createMediaStreamSource(mediaStream);
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 1024;
      source.connect(analyser);
      drawWaveform();
      logEvent("ë…¹ìŒì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.");
    } catch (err) {
      console.error("ë…¹ìŒ ì‹œì‘ ì‹¤íŒ¨:", err);
      alert("ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.");
      const btnStart = document.getElementById("btnStartRecord");
      const btnStop = document.getElementById("btnStopRecord");
      const btnAnalyze = document.getElementById("btnAnalyze");
      btnStart.disabled = false;
      btnStop.disabled = true;
      btnAnalyze.disabled = true;
    }
  }

  function stopRecording() {
    const btnStop = document.getElementById("btnStopRecord");
    btnStop.disabled = true;
    if (mediaRecorder && mediaRecorder.state !== "inactive") {
      mediaRecorder.stop();
    }
    if (mediaStream) {
      mediaStream.getTracks().forEach(t => t.stop());
      mediaStream = null;
    }
    if (waveAnimationId) {
      cancelAnimationFrame(waveAnimationId);
      waveAnimationId = null;
    }
    logEvent("ë…¹ìŒì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤.");
  }

  function analyzeRecording() {
    if (!recordingChunks.length) {
      alert("ë¨¼ì € ë…¹ìŒì„ ì§„í–‰í•´ ì£¼ì„¸ìš”.");
      return;
    }
    const durationMs = performance.now() - recordingStartTime;
    const durationSec = durationMs / 1000;

    const targetSentence = document.getElementById("targetSentence").value;

    const lengthScore =
      durationSec < 0.7
        ? 20
        : durationSec > 4
        ? 40
        : 60 + Math.max(0, 40 - Math.abs(durationSec - 2.0) * 15);

    const loudnessScore = lastRMS <= 0.02
      ? 20
      : lastRMS >= 0.3
      ? 50
      : 50 + (lastRMS * 100);

    let baseScore = Math.round((lengthScore + loudnessScore) / 2);
    baseScore = Math.max(10, Math.min(100, baseScore));

    if (durationSec < 0.8) baseScore = Math.max(5, baseScore - 25);

    state.attempts += 1;
    state.totalScore += baseScore;
    addXP(30);
    updateBadgesAndStats();

    const scoreText = document.getElementById("scoreText");
    const scoreDetail = document.getElementById("scoreDetail");
    const rhythmChips = document.getElementById("rhythmChips");

    if (scoreText) {
      scoreText.textContent = baseScore + "ì ";
      scoreText.classList.toggle("good", baseScore >= 75);
      scoreText.classList.toggle("bad", baseScore < 50);
    }

    if (scoreDetail) {
      const lengthDesc =
        durationSec < 1.0
          ? "ë°œìŒ ê¸¸ì´ê°€ ì¡°ê¸ˆ ì§§ì•„ìš”. í•œ ë²ˆ ë” ê¸¸ê²Œ ë§í•´ ë³¼ê¹Œìš”?"
          : durationSec > 4.0
          ? "ì¡°ê¸ˆ ê¸´ í¸ì´ì—ìš”. ìì—°ìŠ¤ëŸ½ê²Œ ëŠì–´ ì½ëŠ” ì—°ìŠµì„ í•´ ë´…ì‹œë‹¤."
          : "ê¸¸ì´ëŠ” ì ì ˆí•©ë‹ˆë‹¤. ë¦¬ë“¬ê³¼ ê°•ì„¸ë¥¼ ë” ì‹ ê²½ ì¨ ë³¼ê¹Œìš”?";
      const loudDesc =
        lastRMS < 0.03
          ? "ëª©ì†Œë¦¬ê°€ ì‘ê²Œ ì¸ì‹ë˜ì—ˆìŠµë‹ˆë‹¤. ì•½ê°„ ë” í˜ ìˆê²Œ ë°œìŒí•´ ì£¼ì„¸ìš”."
          : lastRMS > 0.25
          ? "ì¶©ë¶„íˆ í¬ê²Œ ë°œìŒí–ˆì–´ìš”. ë„ˆë¬´ í˜ì„ ì£¼ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ìš”."
          : "ë³¼ë¥¨ë„ ì ë‹¹í•©ë‹ˆë‹¤. ì…ëª¨ì–‘ê³¼ ë¦¬ë“¬ì— ì§‘ì¤‘í•´ ë´…ì‹œë‹¤.";
      scoreDetail.textContent =
        `ëª©í‘œ ë¬¸ì¥: "${targetSentence}" Â· ë…¹ìŒ ì‹œê°„: ${durationSec.toFixed(1)}ì´ˆ Â· ` +
        `ê¸¸ì´ ì ìˆ˜: ${Math.round(lengthScore)} / ë³¼ë¥¨ ì ìˆ˜: ${Math.round(loudnessScore)}. ` +
        lengthDesc + " " + loudDesc;
    }

    if (rhythmChips) {
      rhythmChips.innerHTML = "";
      const rhythmChip = document.createElement("span");
      rhythmChip.className = "chip";
      if (durationSec < 1.0) {
        rhythmChip.textContent = "ë¦¬ë“¬: ë„ˆë¬´ ë¹ ë¦„ (í•œ ë°•ì ë” ê¸¸ê²Œ)";
      } else if (durationSec > 3.5) {
        rhythmChip.textContent = "ë¦¬ë“¬: ì•½ê°„ ëŠë¦¼ (ì¢€ ë” ë¦¬ë“¬ê° ìˆê²Œ)";
      } else {
        rhythmChip.textContent = "ë¦¬ë“¬: ì•ˆì •ì  (ì¢‹ì•„ìš”!)";
      }
      const loudChip = document.createElement("span");
      loudChip.className = "chip";
      loudChip.textContent =
        lastRMS < 0.03
          ? "ê°•ë„: ì‘ìŒ (ì—ë„ˆì§€ ì¶”ê°€)"
          : lastRMS > 0.25
          ? "ê°•ë„: ê°•í•¨ (ë¶€ë“œëŸ½ê²Œ ì¡°ì ˆ)"
          : "ê°•ë„: ì ë‹¹í•¨";

      const tipChip = document.createElement("span");
      tipChip.className = "chip";
      tipChip.textContent = "TIP: ê°™ì€ ë¬¸ì¥ì„ 2~3íšŒ ë°˜ë³µí•˜ë©° ì ìˆ˜ ë³€í™”ë¥¼ ë¹„êµí•´ ë³´ì„¸ìš”.";

      rhythmChips.appendChild(rhythmChip);
      rhythmChips.appendChild(loudChip);
      rhythmChips.appendChild(tipChip);
    }

    logEvent(`ë°œìŒ ë¶„ì„ ì™„ë£Œ Â· ì ìˆ˜ ${baseScore}ì `);
  }

  document.getElementById("btnStartRecord").addEventListener("click", startRecording);
  document.getElementById("btnStopRecord").addEventListener("click", stopRecording);
  document.getElementById("btnAnalyze").addEventListener("click", analyzeRecording);

  setInterval(() => {
    const btnAnalyze = document.getElementById("btnAnalyze");
    if (mediaRecorder && mediaRecorder.state === "inactive" && recordingChunks.length > 0) {
      btnAnalyze.disabled = false;
    }
  }, 1000);

  // ----------------------
  // ì§„ë™ ì œì–´
  // ----------------------
  const vibrationStatus = document.getElementById("vibrationStatus");
  const supportsVibration = "vibrate" in navigator;

  if (vibrationStatus) {
    vibrationStatus.textContent = supportsVibration
      ? "ì´ ê¸°ê¸°ëŠ” ì§„ë™ APIë¥¼ ì§€ì›í•©ë‹ˆë‹¤. íŒ¨í„´ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì§„ë™ì„ ëŠê»´ ë³´ì„¸ìš”."
      : "ì´ ë¸Œë¼ìš°ì €/ê¸°ê¸°ëŠ” ì§„ë™ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
  }

  document.querySelectorAll("button[data-vibrate]").forEach(btn => {
    btn.addEventListener("click", () => {
      state.usedModules.vibration = true;
      updateBadgesAndStats();

      if (!supportsVibration) {
        alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ì§„ë™ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return;
      }
      const type = btn.getAttribute("data-vibrate");
      let pattern;
      switch (type) {
        case "rhythm":
          pattern = [0, 120, 60, 260, 80, 120];
          break;
        case "stress":
          pattern = [0, 80, 40, 240, 60, 80];
          break;
        case "length":
          pattern = [0, 150, 60, 350];
          break;
        case "combo":
        default:
          pattern = [0, 100, 40, 220, 50, 80, 40, 260];
          break;
      }
      navigator.vibrate(pattern);
      logEvent(`ì§„ë™ íŒ¨í„´ ì¬ìƒ: ${type}`);
    });
  });

  // ----------------------
  // ë¦½ë¦¬ë”© ëª¨ë“ˆ
  // ----------------------
  const mouthShapes = [
    { label: "ì•„", desc: "ì…ì„ í¬ê²Œ ë²Œë¦¬ê³  í„±ì„ ì¶©ë¶„íˆ ë‚´ë ¤ ì£¼ì„¸ìš”." },
    { label: "ìš°", desc: "ì…ìˆ ì„ ì•ìœ¼ë¡œ ëª¨ìœ¼ê³  ë™ê·¸ë—ê²Œ ë§ì•„ ì£¼ì„¸ìš”." },
    { label: "ì´", desc: "ì˜†ìœ¼ë¡œ ê¸¸ê²Œ ë²Œë ¤ì„œ ì¹˜ì•„ê°€ ì¡°ê¸ˆ ë³´ì´ë„ë¡ í•©ë‹ˆë‹¤." },
    { label: "ë°”", desc: "ë‘ ì…ìˆ ì„ ë‹«ì•˜ë‹¤ê°€ ìˆœê°„ì ìœ¼ë¡œ ë–¼ë©´ì„œ ë°œìŒí•©ë‹ˆë‹¤." },
    { label: "ì‚¬", desc: "ìœ—ë‹ˆì™€ ì•„ë«ë‹ˆ ì‚¬ì´ë¡œ ë°”ëŒì´ íë¥´ë„ë¡ ë°œìŒí•©ë‹ˆë‹¤." }
  ];
  let mouthIndex = 0;

  const mouthShapeEl = document.getElementById("mouthShape");
  const mouthDescEl = document.getElementById("mouthDescription");

  function updateMouthUI() {
    const shape = mouthShapes[mouthIndex];
    if (mouthShapeEl) mouthShapeEl.textContent = shape.label;
    if (mouthDescEl) mouthDescEl.textContent = shape.desc;
  }

  document.getElementById("btnPrevMouth").addEventListener("click", () => {
    state.usedModules.lipreading = true;
    updateBadgesAndStats();

    mouthIndex = (mouthIndex - 1 + mouthShapes.length) % mouthShapes.length;
    updateMouthUI();
  });

  document.getElementById("btnNextMouth").addEventListener("click", () => {
    state.usedModules.lipreading = true;
    updateBadgesAndStats();

    mouthIndex = (mouthIndex + 1) % mouthShapes.length;
    updateMouthUI();
  });

  updateMouthUI();

  let cameraStream = null;
  const cameraPreview = document.getElementById("cameraPreview");
  const cameraStatus = document.getElementById("cameraStatus");
  const btnStartCamera = document.getElementById("btnStartCamera");
  const btnStopCamera = document.getElementById("btnStopCamera");

  async function startCamera() {
    try {
      state.usedModules.lipreading = true;
      updateBadgesAndStats();

      cameraStatus.textContent = "ì¹´ë©”ë¼ë¥¼ ì—¬ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
      btnStartCamera.disabled = true;
      btnStopCamera.disabled = false;
      cameraStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "user" },
        audio: false
      });
      cameraPreview.srcObject = cameraStream;
      cameraStatus.textContent = "ì¹´ë©”ë¼ê°€ ì¼œì¡ŒìŠµë‹ˆë‹¤. ì…ëª¨ì–‘ì„ í™”ë©´ì—ì„œ í™•ì¸í•´ ë³´ì„¸ìš”.";
      logEvent("ì¹´ë©”ë¼ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.");
    } catch (e) {
      console.error(e);
      cameraStatus.textContent = "ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.";
      btnStartCamera.disabled = false;
      btnStopCamera.disabled = true;
    }
  }

  function stopCamera() {
    if (cameraStream) {
      cameraStream.getTracks().forEach(t => t.stop());
      cameraStream = null;
    }
    cameraPreview.srcObject = null;
    btnStartCamera.disabled = false;
    btnStopCamera.disabled = true;
    cameraStatus.textContent = "ì¹´ë©”ë¼ê°€ êº¼ì¡ŒìŠµë‹ˆë‹¤.";
    logEvent("ì¹´ë©”ë¼ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤.");
  }

  btnStartCamera.addEventListener("click", startCamera);
  btnStopCamera.addEventListener("click", stopCamera);

  // ----------------------
  // ì§„í–‰ë„ ì´ˆê¸°í™”
  // ----------------------
  document.getElementById("btnResetProgress").addEventListener("click", () => {
    if (!confirm("ëª¨ë“  ì§„í–‰ë„ì™€ ë°°ì§€ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
    localStorage.removeItem(STORAGE_KEY);
    state.xp = 0;
    state.level = 1;
    state.attempts = 0;
    state.totalScore = 0;
    state.badges.consistency = false;
    state.badges.rhythmMaster = false;
    state.badges.allModules = false;
    state.usedModules.pronunciation = false;
    state.usedModules.vibration = false;
    state.usedModules.lipreading = false;
    updateUIFromState();
    logEvent("ì§„í–‰ë„ë¥¼ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.");
  });

  // ----------------------
  // ì´ˆê¸°ê°€ë™
  // ----------------------
  window.addEventListener("load", () => {
    resizeCanvas();
    loadState();
    logEvent("SoundStudy ë°ëª¨ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ëª¨ë“ˆë¶€í„° ììœ ë¡­ê²Œ ì²´í—˜í•´ ë³´ì„¸ìš”.");
  });
</script>
</body>
</html>

